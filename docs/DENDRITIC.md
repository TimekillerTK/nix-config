# Dendritic Nix for this repository

This document describes how this repository uses the **dendritic pattern** to structure nix configs for NixOS hosts, home-manager configurations, and reusable features.

Nix configs using the **dendritic pattern** can differ user to user, as it's more a set of guidelines rather than a strict set of rules.

Case in point, while this repository was created based on [Dendritic Design with Flake Parts](https://github.com/Doc-Steve/dendritic-design-with-flake-parts), not all the same flake inputs are used in my config:

- ✅️ [flake-parts](https://flake.parts/)
- ✅️ [pkgs-by-name-for-flake-parts](https://github.com/drupol/pkgs-by-name-for-flake-parts)
- ✅️ [import-tree](https://github.com/vic/import-tree)
- ✅️ [home-manager](https://github.com/nix-community/home-manager/)
- ❌️ [determinate flake-hub](https://flakehub.com/flake/DeterminateSystems/determinate) - not used
- ❌️ [flake-file](https://github.com/vic/flake-file) - not used
- ❌️ [agenix](https://github.com/ryantm/agenix) - using [sops](https://github.com/Mic92/sops-nix) instead
- ❌️ `darwin-*` or `brew-*` - not needed because no `nix-darwin` configs

## Creating a New NixOS Host

To create a definition of a new NixOS host called `example`, at minimum create a `configuration.nix` file in `modules/hosts/example/`.

> NOTE: location and file naming is arbitrary, because of `import-tree` and `flake-parts`, these files can be placed **anywhere** in `modules/`

`modules/hosts/example/configuration.nix`

```nix
{inputs, ...}: {
  flake.nixosConfigurations = inputs.self.lib.mkNixos "x86_64-linux" "example";

  flake.modules.nixos.example = {pkgs, ...}: {
    imports = [
      # NixOS module imports here...
    ];

    home-manager.users.tk = {
      imports = [
        # home-manager module mports here...
      ];
      # Normal home-manager config stuff goes here
    };
  };
}
```

You must also add a `hardware-configuration.nix`, which is a file usually automatically generated during the installation of your NixOS host, or generated by the command on an existing host:

```sh
sudo nixos-generate-config --show-hardware-config > modules/hosts/example/hardware-configuration.nix
```

`modules/hosts/example/hardware-configuration.nix`

```nix
{
  flake.modules.nixos.example = {
    config,
    lib,
    pkgs,
    modulesPath,
    ...
  }: {
    imports = [
        # NixOS module imports here
    ];
    # Normal NixOS Hardware Configuration file contents here
  }
}
```
